---
name: shield-agent
packages:
  - shield
  - bsdtar
  - plugins

templates:
  bin/shield-agent:         bin/shield-agent
  bin/post-start:           bin/post-start
  bin/emergency-recovery:   bin/emergency-recovery

  config/agent.conf:        config/agent.conf
  config/agent.key:         config/agent.key
  config/import.yml:        config/import.yml

consumes:
  - name: core
    type: core
    optional: true

properties:
  ip:
    description: IP address that the agent can be contacted at.  Normally, this can be automatically detected, but for certain circumstances (i.e. bosh-init deployments), you must specify it.
  port:
    description: "port to run agent"
    default: 5444

  agent.key:
    description: RSA private key used for securing communications between SHIELD Agents and the SHIELD Core.

  import:
    description: A complete `buckler import' YAML file, for importing and auto-provisioning tenants, users, cloud storage, data systems, etc.

  autoprovision:
    description: "Optional. Either 'true' to autoprovision via core link; HTTP API of the SHIELD API to automatically retrieve the shield-daemon SSH Public Key from.  You must at least specify this property, or the daemon_public_key property."

  log_level:
    description: "Log level for shield processes"
    default: "info"

  recovery.target_plugin:
    description: "Target plugin to use in emergency-recovery-mode"
  recovery.target_config:
    description: "A map of key-values that will be converted to JSON, representing the target plugin configration"
  recovery.store_plugin:
    description: "Store plugin to use in emergency-recovery-mode"
  recovery.store_config:
    description: "A map of key-values that will be converted to JSON, representing the store plugin configration"

  env.path:
    description: A list of paths to append to $PATH, so that plugins can find tools and utilities when they run.
  env.libs:
    description: A list of paths to append to $LD_LIBRARY_PATH, so that plugins can use tools and utilities when they run.
  env.auto:
    description: Augment the plugin environment with the appropriate bin/, sbin/, and lib/ directories from all BOSH packages named 'shield-addon-*'
    default: true

  plugin_paths:
    description: "Map of paths that the binary of the plugins can be found"
    example: |
      plugin_paths:
        atmos: /var/vcap/packages/atmos-plugin/bin
