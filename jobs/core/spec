---
name: core
packages:
  - shield
  - nginx
  - vault

templates:
  # vault secure storage
  bin/vault:            bin/vault
  config/vault.conf:    config/vault.conf

  # shieldd core
  bin/shieldd:          bin/shieldd
  config/shieldd.conf:  config/shieldd.conf
  config/agent.key:     config/agent.key

  # nginx reverse proxy
  bin/nginx:            bin/nginx
  config/nginx.conf:    config/nginx.conf
  config/tls.pub:       config/tls.pub
  config/tls.key:       config/tls.key

provides:
  - name: shield
    type: shield
    properties: [domain, port]

properties:
  domain:
    description: Fully-qualified domain name (or IP address) of your SHIELD installation
  port:
    description: Incoming port to bind for HTTPS API and Web UI
    default: 443

  core.env:
    description: A short tag describing this environment (i.e. 'prod', 'staging', etc.).
    default: sandbox
  core.color:
    description: What color should the SHIELD Web UI render the environment tag in.
    default: yellow
  core.motd:
    description: A (perhaps long-form) message of the day, to display on login forms.
    default: Welcome to SHIELD!

  failsafe.username:
    description: A fallback username for initially accessiong your SHIELD instance.
    default: admin
  failsafe.password:
    description: A password for the failsafe user.
    default: shield

  core.workers:
    description: Maximum allowable number of running, concurrent tasks.
    default: 5
  core.task-timeout:
    description: How long after start of execution before timing out a running task.
    default: 12h
  core.session-timeout:
    description: How long should sessions be valid for.
    default: 8h
  core.fast-loop:
    description: How frequently should SHIELD check for and execute scheduled jobs.
    default: 5s
  core.slow-loop:
    description: How frequently should SHIELD perform janitorial tasks.
    default: 1h

  tls.key:
    description: "TLS private key (PEM encoded), used for the HTTPS API and Web UI"
  tls.certificate:
    description: "TLS Certificate (PEM encoded), used for the HTTPS API and Web UI"
  tls.reuse-after:
    description: "How long (in hours) before rotating cryptographic parameters"
    default: 2

  agent.key:
    description: RSA private key used for securing communications between SHIELD Agents and the SHIELD Core.

  log-level:
    description: Log level for the SHIELD Core.  One of 'error', 'warning', or 'info'.
    default: "info"

  nginx.workers:
    description: "Number of nginx workers"
    default: 2
  nginx.connections:
    description: "Number of nginx connections per worker"
    default: 8192
  nginx.keepalive:
    description: "Timeout for keep-alive connections"
    default: "75 20"

  vault.warden:
    description: Whether or not to disable memory locking, which must only be done on container substrates like Warden.
    default: false

  migrate-from.type:
    description: What type of legacy (pre-v8) database to migrate from (optional).
  migrate-from.dsn:
    description: The full datasource name of a legacy (pre-v8) database to migrate from.
